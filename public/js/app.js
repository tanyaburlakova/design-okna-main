var app=angular.module("myApp",["ngMeta","ngRoute","ngTouch","ngSVGAttributes","mainCtrl","homeCtrl","dialogCtrl","articleCtrl","catalogCtrl","searchCtrl","orderCtrl","feedbackCtrl","trendCtrl","constructorPageCtrl","productPageCtrl","cartDirective","constructorPreviewDirective","checkboxDirective","textureDirective","hiderDirective","offCanvasDirective","responsiveDirective","parallaxDirective","questionDirective","articlePreviewDirective","dialogDirective","colorDirective","rangeDirective","seoDirective","youtube-embed","ngDropdowns","angular-input-stars","angular-owl-carousel","LocalStorageModule"]).config(["$routeProvider","$locationProvider",function($routeProvider,$locationProvider,ngMeta){"use strict";$locationProvider.html5Mode(!1),$locationProvider.hashPrefix("!"),$routeProvider.when("/",{controller:"HomeCtrl",templateUrl:"views/home.html",meta:{title:"Дизайн окна. Мастерская по изготовлению жалюзи и штор в Москве.",description:"Современное оформление окон: жалюзи, карнизы, шторы, текстиль, рольставни в Москве.",ogUrl:"https://design-okna.ru",ogTitle:"Дизайн окна. Мастерская по изготовлению жалюзи в Москве.",ogDescription:"Современное оформление окон: жалюзи, карнизы, шторы, текстиль, рольставни в Москве.",ogImage:"https://design-okna.ru/img/fb.jpg"}}).when("/article/:slug",{controller:"ArticleCtrl",templateUrl:"views/article.html",meta:{ogUrl:"https://design-okna.ru",ogTitle:"Дизайн окна. Мастерская по изготовлению жалюзи в Москве.",ogDescription:"Современное оформление окон: жалюзи, карнизы, шторы, текстиль, рольставни в Москве.",ogImage:"https://design-okna.ru/img/fb.jpg"}}).when("/search/:term",{controller:"CatalogCtrl",templateUrl:"views/catalog.html",meta:{ogUrl:"https://design-okna.ru",ogTitle:"Дизайн окна. Мастерская по изготовлению жалюзи в Москве.",ogDescription:"Современное оформление окон: жалюзи, карнизы, шторы, текстиль, рольставни в Москве.",ogImage:"https://design-okna.ru/img/fb.jpg"}}).when("/catalog",{controller:"CatalogCtrl",templateUrl:"views/catalog.html",reloadOnSearch:!1,meta:{ogUrl:"https://design-okna.ru",ogTitle:"Дизайн окна. Мастерская по изготовлению жалюзи в Москве.",ogDescription:"Современное оформление окон: жалюзи, карнизы, шторы, текстиль, рольставни в Москве.",ogImage:"https://design-okna.ru/img/fb.jpg"}}).when("/catalog/:category",{controller:"CatalogCtrl",templateUrl:"views/catalog.html",reloadOnSearch:!1,meta:{ogUrl:"https://design-okna.ru",ogTitle:"Дизайн окна. Мастерская по изготовлению жалюзи в Москве.",ogDescription:"Современное оформление окон: жалюзи, карнизы, шторы, текстиль, рольставни в Москве.",ogImage:"https://design-okna.ru/img/fb.jpg"}}).when("/catalog/:category/:subcategory",{controller:"CatalogCtrl",templateUrl:"views/catalog.html",reloadOnSearch:!1,meta:{ogUrl:"https://design-okna.ru",ogTitle:"Дизайн окна. Мастерская по изготовлению жалюзи в Москве.",ogDescription:"Современное оформление окон: жалюзи, карнизы, шторы, текстиль, рольставни в Москве.",ogImage:"https://design-okna.ru/img/fb.jpg"}}).when("/catalog/:category/:subcategory/:searchtype",{controller:"CatalogCtrl",templateUrl:"views/catalog.html",reloadOnSearch:!1,meta:{ogUrl:"https://design-okna.ru",ogTitle:"Дизайн окна. Мастерская по изготовлению жалюзи в Москве.",ogDescription:"Современное оформление окон: жалюзи, карнизы, шторы, текстиль, рольставни в Москве.",ogImage:"https://design-okna.ru/img/fb.jpg"}}).when("/product/:category/:subcategory/:product",{controller:"ProductPageCtrl",templateUrl:"views/product.html",reloadOnSearch:!1,meta:{ogUrl:"https://design-okna.ru",ogTitle:"Дизайн окна. Мастерская по изготовлению жалюзи в Москве.",ogDescription:"Современное оформление окон: жалюзи, карнизы, шторы, текстиль, рольставни в Москве.",ogImage:"https://design-okna.ru/img/fb.jpg"}}).when("/product/:category/:subcategory/:product/:texture",{controller:"ProductPageCtrl",templateUrl:"views/product.html",reloadOnSearch:!1,meta:{ogUrl:"https://design-okna.ru",ogTitle:"Дизайн окна. Мастерская по изготовлению жалюзи в Москве.",ogDescription:"Современное оформление окон: жалюзи, карнизы, шторы, текстиль, рольставни в Москве.",ogImage:"https://design-okna.ru/img/fb.jpg"}}).when("/constructor",{controller:"ConstructorPageCtrl",templateUrl:"views/constructor.html",meta:{title:"Конструктор жалюзи и штор онлайн. Дизайн окна.",description:"При помощи нашего конструктора вы можете легко подобрать шторы или жалюзи не выходя из дома.",ogUrl:"https://design-okna.ru/#!/constructor",ogTitle:"Онлайн конструктор жалюзи и штор",ogDescription:"Приложите жалюзи и шторы к вашему окну в реальном времени, выберите цвет и материал.",ogImage:"https://design-okna.ru/img/fbcon.jpg"}}).otherwise({redirectTo:"/"})}]).run(["ngMeta",function(ngMeta){ngMeta.init()}]).run(["$route","$rootScope","$location",function($route,$rootScope,$location){var original=$location.path;$location.path=function(path,reload){if(reload===!1)var lastRoute=$route.current,un=$rootScope.$on("$locationChangeSuccess",function(){$route.current=lastRoute,un()});return original.apply($location,[path])}}]);app.constant("API_PATH","data/"),function(){"use strict";function articleCtrl(ngMeta,$scope,$log,$sce,$routeParams,ArticleService,SocialShareService){var networks=["vk","ok","fb"];$scope.init=function(){$scope.$parent.constructorHeader=!1,$scope.article={},$scope.socials=[],$scope.getArticle()},$scope.getArticle=function(){var slug=$routeParams.slug||$scope.slug;ArticleService.getArticle(slug).then(function(data){ngMeta.setTag("description",data.description),ngMeta.setTitle(data.title+". Дизайн окна."),$scope.$parent.blockContent=data.blockContent?data.blockContent:"",$scope.article=data,$scope.article.content=$sce.trustAsHtml(data.text),$scope.prepareShareUrls()},function(err){$log.log(err)})},$scope.prepareShareUrls=function(){angular.forEach(networks,function(value,key){$scope.socials.push({name:value,icon:"icons/icons.svg#"+value,url:SocialShareService.getShareUrl(value,{title:$scope.article.title,url:$scope.article.url,description:$sce.trustAsHtml($scope.article.description),image:$scope.article.main_img})})})},$scope.init()}angular.module("articleCtrl",["articleService","socialShareService"]).controller("ArticleCtrl",["ngMeta","$scope","$log","$sce","$routeParams","ArticleService","SocialShareService",articleCtrl])}(),function(){"use strict";function benefitsCtrl($scope,$log,BenefitsService){var url=$scope.url,newParams={};$scope.idproduct?newParams.productId=$scope.idproduct:newParams.mainPage=!0,$scope.init=function(){$scope.getBenefits(url)},$scope.getBenefits=function(url){BenefitsService.getBenefits(url,newParams).then(function(data){$scope.benefits=data},function(err){$log.error(err)})},$scope.init()}angular.module("benefitsCtrl",["benefitsService"]).controller("BenefitsCtrl",["$scope","$log","BenefitsService",benefitsCtrl])}(),function(){"use strict";function cartCtrl($rootScope,$scope,$log,CartService,DialogService){$scope.dropdownVisible=!1,$scope.init=function(){$scope.items=CartService.getProducts()},$scope.showDropdown=function(){$scope.dropdownVisible=!0},$scope.hideDropdown=function(){$scope.dropdownVisible=!1},$scope.openOrder=function(){DialogService.setState("order")},$scope.removeProduct=function(key){CartService.removeProduct(key),0===$scope.items.length&&($scope.dropdownVisible=!1)},$scope.touchTogle=function(){$scope.dropdownVisible=!$scope.dropdownVisible},$scope.init()}angular.module("cartCtrl",["cartService","dialogService"]).controller("CartCtrl",["$rootScope","$scope","$log","CartService","DialogService",cartCtrl])}(),function(){"use strict";function catalogCtrl(ngMeta,$scope,$log,$routeParams,$location,ProductService,CatalogService,ConfigService,ResponsiveService,$timeout){$scope.init=function(){$scope.responsive=ResponsiveService,$scope.$parent.constructorHeader=!1,$scope.catalogItems=[],$scope.categoryChecks={},$scope.priceSlider=null,$scope.maxPrice=ConfigService.maxPrice,$routeParams.subcategory&&($scope.categoryChecks[$routeParams.subcategory]=!0),$scope.searchOptions={sort:"date",count:9,min_price:ConfigService.minPrice,max_price:ConfigService.maxPrice,category:$routeParams.category,"subcategory[]":$routeParams.subcategory?[$routeParams.subcategory]:[]},$scope.$watchCollection("searchOptions",function(oldVal,newVal){$scope.getProductList()}),$scope.$watchCollection("categoryChecks",function(oldVal,newVal){if(!_.isEqual(oldVal,newVal)){var arr=[];angular.forEach($scope.categoryChecks,function(item,key){item&&arr.push(key)}),$scope.searchOptions["subcategory[]"]=arr,1===$scope.searchOptions["subcategory[]"].length?$location.path("catalog/"+$scope.searchOptions.category+"/"+$scope.searchOptions["subcategory[]"],!1):$location.path("catalog/"+$scope.searchOptions.category,!1)}}),$scope.getCatalog()},$scope.getCatalog=function(){$scope.$parent.showLoader=!0,CatalogService.getCatalog({category:$routeParams.category,subcategory:$routeParams.subcategory}).then(function(data){$scope.$parent.blockContent=data.blockContent?data.blockContent:"",$scope.pageOptions=data,angular.forEach($scope.pageOptions.subcategories,function(item){item.checked=item.slug===$routeParams.subcategory?!0:null}),$scope.$parent.showLoader=!1},function(err){$log.log(err)})},$scope.addProductList=function(){ProductService.getList(angular.extend({},$scope.searchOptions,{skip:$scope.catalogItems.length})).then(function(data){var items=data.items;0===items.length?$scope.showLoadMoreBtn=!1:($scope.showLoadMoreBtn=!0,Array.prototype.push.apply($scope.catalogItems,items))},function(err){$log.log(err)})},$scope.getProductList=function(){ProductService.getList($scope.searchOptions).then(function(data){ngMeta.setTag("description",data.description),ngMeta.setTitle(data.title+". Дизайн окна.");var maxPrice=parseInt(data.maxPrice);maxPrice!==$scope.maxPrice&&($scope.priceSlider=null,$scope.maxPrice=maxPrice,$scope.resetSlider());var items=data.items;0===items.length?$scope.showLoadMoreBtn=!1:($scope.showLoadMoreBtn=!0,$scope.catalogItems=items)},function(err){$log.log(err)})},$scope.toggleSort=function(sortTerm){$scope.searchOptions.sort=$scope.searchOptions.sort===sortTerm?null:sortTerm},$scope.resetSlider=function(){$timeout(function(){$scope.priceSlider={min:ConfigService.minPrice,max:$scope.maxPrice,options:{floor:ConfigService.minPrice,ceil:$scope.maxPrice}}},10),$scope.$on("rangeDirective.updateRangeSlider",function(e){$scope.searchOptions.min_price=$scope.priceSlider.min,$scope.searchOptions.max_price=$scope.priceSlider.max})},$scope.init()}angular.module("catalogCtrl",["productCtrl","productService","catalogService","configService","catalogResponsiveDirective"]).controller("CatalogCtrl",["ngMeta","$scope","$log","$routeParams","$location","ProductService","CatalogService","ConfigService","ResponsiveService","$timeout",catalogCtrl])}(),function(){"use strict";function constructorPageCtrl($rootScope,$scope,$log,$timeout,TexturesService,MenuService,CartService,ResponsiveService){$scope.priceSlider={min:100,max:180,options:{floor:0,ceil:450}},$scope.infoExpand=!1,$scope.firstLoad=!0;var menu={};$scope.init=function(){$scope.currentTab="louvers",$scope.typesModel={},$scope.textureModel=null,$scope.textureId=null,$scope.mobile=ResponsiveService.getState("mobileLandscape"),MenuService.getMenu().then(function(data){menu=data.items,$scope.prepareTypes(!0),$scope.$parent.blockContent=data.blockContent?data.blockContent:""},function(err){console.log(err)}),$scope.$parent.constructorHeader=!0},$scope.prepareTypes=function(withModels){$scope.types=_.map(menu[$scope.currentTab],function(item){return{url:item.url,value:item.url.replace("/catalog/",""),label:item.title,category:"louvers"===$scope.currentTab?"Жалюзи":"Шторы"}}),$scope.typesModel=$scope.types[0],withModels&&$scope.prepareModels($scope.typesModel)},$scope.prepareModels=function(selected){$scope.models=_.map(_.findLast(menu[$scope.currentTab],"url",selected.url).children,function(item){return{url:item.url,value:item.url.replace("/catalog/",""),label:item.constructorTitle}}),$scope.models.length?($scope.modelsModel=$scope.models[0],$scope.getConstructorTextures($scope.modelsModel)):($scope.modelsModel={},$scope.getConstructorTextures(!1))},$scope.getConstructorTextures=function(model){var route=[],category="",subcategory="";model?(route=/([A-z]+)\/([A-z]+)\/([A-z]+)/g.exec(model.url),category=route[2],subcategory=route[3]):(route=/([A-z]+)\/([A-z]+)/g.exec($scope.typesModel.url),category=route[2],subcategory=null),TexturesService.getConstructorTextures({category:category,subcategory:subcategory}).then(function(data){$scope.textures=data,$scope.$watch("textureId",function(newVal){newVal&&($scope.texture=TexturesService.getTextureById(newVal),$scope.product={image:$scope.texture.product_image,title:$scope.texture.product_name,price:$scope.texture.price,texture:$scope.texture.model},$scope.mobile&&!$scope.firstLoad&&($("html, body").animate({scrollTop:0},{duration:700}),$scope.infoExpand=!0,$scope.hideInfoExpand()),$scope.firstLoad&&($scope.firstLoad=!1))}),$scope.textureId=$scope.textures[0].id},function(err){$log.log(err)})},$scope.hideInfoExpand=function(){_.delay(function(){$scope.$apply(function(){$scope.infoExpand=!1})},4e3)},$scope.addToCart=function(){CartService.addProduct($scope.product)},$scope.$on("ResponsiveService.updateState",function(){$scope.$apply(function(){$scope.mobile=ResponsiveService.getState("mobileLandscape")})}),$scope.init()}angular.module("constructorPageCtrl",["naif.base64","menuService","texturesService","cartService"]).controller("ConstructorPageCtrl",["$rootScope","$scope","$log","$timeout","TexturesService","MenuService","CartService","ResponsiveService",constructorPageCtrl])}(),function(){"use strict";function constructorPreviewCtrl($scope,$log){$scope.$log=$log}angular.module("constructorPreviewCtrl",[]).controller("ConstructorPreviewCtrl",["$scope","$log",constructorPreviewCtrl])}(),function(){"use strict";function dialogCtrl($rootScope,$scope,$log,DialogService){$scope.url;$scope.init=function(){$scope.state=DialogService.getState()},$scope.CloseDialog=function(){$scope.state=!1,DialogService.setState(!1)},$rootScope.$on("DialogService.updateState",function(e){$scope.state=DialogService.getState(),$scope.picture="picture"===$scope.state?DialogService.getImage():"",$scope.content="feedback"===$scope.state&&"order"===$scope.state?!0:!1}),$scope.init()}angular.module("dialogCtrl",["dialogService","cartService"]).controller("DialogCtrl",["$rootScope","$scope","$log","DialogService",dialogCtrl])}(),function(){"use strict";function feedbackCtrl($scope,$log,CartService){$scope.init=function(){$scope.message={name:"",email:"",text:""},$scope.state={complete:!1,loading:!1}},$scope.submitForm=function(){$scope.state.loading=!0,CartService.submitFeedback($scope.message).then(function(data){$scope.state.loading=!1,$scope.state.complete=!0},function(err){$scope.state.loading=!1})},$scope.init()}angular.module("feedbackCtrl",["cartService"]).controller("FeedbackCtrl",["$scope","$log","CartService",feedbackCtrl])}(),function(){"use strict";function hiderCtrl($scope,$log,$window){$scope.$window=$window}angular.module("hiderCtrl",[]).controller("HiderCtrl",["$scope","$log","$window",hiderCtrl])}(),function(){"use strict";function homeCtrl($rootScope,$scope,$log,ProductService,ConfigService){$scope.init=function(){$scope.$parent.constructorHeader=!1,$scope.showLoadMoreBtn=!0,$scope.catalogItems=[],$scope.featuredProduct={},$scope.featuredArticle=ConfigService.homeArticleSlug,$scope.getFeaturedProduct(),$scope.getProductList()},$scope.getProductList=function(){ProductService.getHomeList({skip:$scope.catalogItems.length,count:8,mainPage:!0}).then(function(data){0===data.length?$scope.showLoadMoreBtn=!1:Array.prototype.push.apply($scope.catalogItems,data.items),$scope.$parent.blockContent=data.blockContent?data.blockContent:""},function(err){$log.log(err)})},$scope.getFeaturedProduct=function(){ProductService.getFeatured().then(function(data){$scope.featuredProduct=data},function(err){$log.log(err)})},$scope.init()}angular.module("homeCtrl",["benefitsDirective","productService","productCtrl","newsDirective","configService","ngMeta"]).controller("HomeCtrl",["$rootScope","$scope","$log","ProductService","ConfigService",homeCtrl])}(),function(){"use strict";function mainCtrl($rootScope,$scope,$log,$timeout,$sce,DialogService,TimeService,ResponsiveService){$scope.filterOpened=!1,$scope.showLoader=!0,$scope.constructorHeader=!1,$scope.workingHours=TimeService.getWorkingHours(),$scope.blockContent="",$scope.touchElement=ResponsiveService.getState("tabletPortrait"),$scope.blockContentHtml="",$scope.$watch("blockContent",function(){$scope.blockContentHtml=$sce.trustAsHtml($scope.blockContent)}),$scope.init=function(){$(function(){svg4everybody({fallback:function(src,svg,use){var className=$(svg).attr("class");$(svg).replaceWith($("<span/>").addClass(className).css("background-image","url("+src.replace("icons.svg#","")+".png)"))}})}),TimeService.logCurrentTime(),$scope.showLoader=!1},$scope.openSearch=function(){DialogService.setState("search")},$scope.openFeedback=function(){DialogService.setState("feedback")},$scope.openCallme=function(){DialogService.setState("callme")},$scope.toggleOffCanvas=function(side){side=side||"left",$scope.offCanvasSide=$scope.offCanvasSide!==side?side:null},$scope.refreshRange=function(){$timeout(function(){$scope.$broadcast("rzSliderForceRender")})},$scope.onClickRange=function(){$scope.togglePricePopup=!$scope.togglePricePopup,$scope.toggleColorsPopup=!1,$scope.refreshRange()},$scope.onClickColor=function(){$scope.toggleColorsPopup=!$scope.toggleColorsPopup,$scope.togglePricePopup=!1},$scope.$on("ResponsiveService.updateState",function(){$scope.offCanvasSide&&(ResponsiveService.getState("tablet")||ResponsiveService.getState("desktop"))&&$scope.$apply(function(){$scope.toggleOffCanvas($scope.offCanvasSide)}),$scope.touchElement=ResponsiveService.getState("tabletPortrait")?!0:!1}),$rootScope.$on("$locationChangeStart",function(){$scope.showLoader=!0}),$rootScope.$on("$locationChangeSuccess",function(){$scope.offCanvasSide&&$scope.toggleOffCanvas($scope.offCanvasSide),$scope.showLoader=!1}),$scope.$on("$routeChangeSuccess",function(){window.scrollTo(0,0)}),$scope.init()}angular.module("mainCtrl",["dialogService","timeService"]).controller("MainCtrl",["$rootScope","$scope","$log","$timeout","$sce","DialogService","TimeService","ResponsiveService",mainCtrl])}(),function(){"use strict";function newsCtrl($scope,$log,NewsService){$scope.url;$scope.init=function(){$scope.news=[],$scope.currentNews=0,$scope.getNews()},$scope.getNews=function(){NewsService.getNews().then(function(data){data.length>0&&($scope.news=data,$scope.news[0].active=!0)},function(err){$log.log(err)})},$scope.init()}angular.module("newsCtrl",["newsService"]).controller("NewsCtrl",["$scope","$log","NewsService",newsCtrl])}(),function(){"use strict";function orderCtrl($scope,$log,CartService,DialogService,TimeService,ConfigService,ResponsiveService){$scope.init=function(){$scope.context=DialogService.getState(),$scope.mobile=ResponsiveService.getState("mobileLandscape"),$scope.products="oneclick"===$scope.context?[CartService.getOneClick()]:CartService.getProducts(),$scope.hours=[];for(var i=ConfigService.openHour;i<ConfigService.closeHour;i++)$scope.hours.push({id:i,label:(10>i?"0"+i:i.toString())+" ч"});$scope.minutes=[];for(var i=0;60>i;i+=15)$scope.minutes.push({id:i,label:(10>i?"0"+i:i.toString())+" м"});$scope.order={phone:"",name:"",hour:$scope.hours[0],min:$scope.minutes[0]},$scope.state={complete:!1,loading:!1},$scope.workingTime=TimeService.isWorkingTime()},$scope.phoneFocus=function(){""===$scope.order.phone&&($scope.order.phone="+7")},$scope.$watch("order.phone",function(){$scope.order.phone.length>12&&($scope.order.phone=$scope.order.phone.substr(0,12))}),$scope.submitForm=function(){var params={};$scope.state.loading=!0,angular.extend(params,{context:$scope.context},$scope.order),"callme"===params.context?CartService.submitCallMe(params).then(function(data){$scope.state.loading=!1,$scope.state.complete=!0},function(err){$scope.state.loading=!1}):CartService.submitOrder(params).then(function(data){$scope.state.loading=!1,$scope.state.complete=!0},function(err){$scope.state.loading=!1})},$scope.$on("ResponsiveService.updateState",function(){$scope.$apply(function(){$scope.mobile=ResponsiveService.getState("mobileLandscape")})}),$scope.init()}angular.module("orderCtrl",["cartService","dialogService","timeService","configService"]).controller("OrderCtrl",["$scope","$log","CartService","DialogService","TimeService","ConfigService","ResponsiveService",orderCtrl])}(),function(){"use strict";function parallaxCtrl($scope,$log,$window){$scope.$window=$window}angular.module("parallaxCtrl",[]).controller("ParallaxCtrl",["$scope","$log","$window",parallaxCtrl])}(),function(){"use strict";function productCtrl($scope,$log,CartService,$location,$route,ResponsiveService){$scope.touchElement=ResponsiveService.getState("tabletPortrait"),$scope.init=function(){$scope.product.texture_id=-1,$scope.isHover=!1},$scope.$on("ResponsiveService.updateState",function(){$scope.touchElement=ResponsiveService.getState("tabletPortrait")?!0:!1}),$scope.addProductToCart=function(product){CartService.addProduct(product)},$scope.$watch("product.texture_id",function(){if(-1!==$scope.product.texture_id){var texture=_.findWhere($scope.product.textures,{id:$scope.product.texture_id});$scope.product.price=texture.price,$scope.product.texture=texture.model,$scope.product.url=texture.url&&texture.url.length>0?"texture="+texture.url:"",$scope.product.texture_link=texture.url&&texture.url.length>0?"texture="+texture.url:""}}),$scope.declOfNum=function(number,titles){var cases=[2,0,1,1,1,2];return titles[number%100>4&&20>number%100?2:cases[5>number%10?number%10:5]]},$scope.actionUrl=function(e,url){"ProductPageCtrl"===$route.current.controller&&(e.stopPropagation(),$location.path(url,!1))},$scope.hoverIt=function(bValue){$scope.isHover=bValue},$scope.init()}angular.module("productCtrl",["cartService"]).controller("ProductCtrl",["$scope","$log","CartService","$location","$route","ResponsiveService",productCtrl])}(),function(){"use strict";function productPageCtrl(ngMeta,$scope,$log,youtubeEmbedUtils,$location,$routeParams,TexturesService,ProductService,CartService,DialogService,ConfigService,$sce,$timeout,ResponsiveService){$scope.init=function(){$scope.toggleMobilePopup=!1,$scope.priceSlider=null,$scope.$parent.constructorHeader=!1,$scope.catalogItems=[],$scope.product={},$scope.product.dimensions={},$scope.product.allowHeight=!0,$scope.product.withCornice=!1,$scope.product.priceExactly=!1,$scope.minPrice=ConfigService.minPrice,$scope.maxPrice=ConfigService.maxPrice,$scope.texturePrice={min:$scope.minPrice,max:$scope.maxPrice},$scope.textureColors={},$scope.gallery={},$scope.gallery.currentImage=-1,$scope.gallery.previewImage="",$scope.textureModel=null,$scope.previewTextureModel=null,$scope.textures=[],$scope.desktop=ResponsiveService.getState("desktop"),$scope.mobile=ResponsiveService.getState("mobileLandscape"),$scope.getProduct()},$scope.calcPrice=function(){var p=$scope.product;$scope.currentTexture&&($scope.product.allowHeight?p.dimensions.width&&p.dimensions.height?(p.priceExactly=!0,p.price=p.withCornice?parseInt($scope.currentTexture.price)*p.dimensions.width*1e-4*p.dimensions.height+parseInt(p.cornice.price):parseInt($scope.currentTexture.price)*p.dimensions.width*1e-4*p.dimensions.height):(p.priceExactly=!1,p.price=p.withCornice?parseInt($scope.currentTexture.price)+parseInt(p.cornice.price):parseInt($scope.currentTexture.price)):p.dimensions.width?(p.priceExactly=!0,p.price=p.withCornice?parseInt($scope.currentTexture.price)*p.dimensions.width*.01+parseInt(p.cornice.price):parseInt($scope.currentTexture.price)*p.dimensions.width*.01):(p.priceExactly=!1,p.price=p.withCornice?parseInt($scope.currentTexture.price)+parseInt(p.cornice.price):parseInt($scope.currentTexture.price)))};var getTexturesPrices=function(list){var priceArray=_.pluck(list,"price");$scope.minPrice=_.min(priceArray),$scope.maxPrice=_.max(priceArray),$scope.resetSlider(),updateTextures(list)},updateTextures=function(list){if(list.length>0){var oHash=($routeParams.category,$routeParams.subcategory,$routeParams.product,$routeParams.texture,$location.path().split("texture=")),hash=oHash[1]?oHash[1]:"",currentTexture=TexturesService.getTextureBySlug(hash)||{id:list[0].id},currentId=currentTexture.id;$scope.textures=list,$scope.textureModel=currentId,$scope.showAllTextures=!1,$scope.$watch("textureModel",function(newVal){if("-1"!==newVal){$scope.getTextureById(newVal);var aLinks=$location.path().split("/"),fullLink="";aLinks.pop(),_.each(aLinks,function(slink){fullLink+=slink+"/"}),$location.path(fullLink+"texture="+$scope.currentTexture.slug,!1),$scope.gallery.previewImage=null,$scope.calcPrice()}}),$scope.$watch("previewTextureModel",function(newVal){$scope.gallery.previewImage=newVal?TexturesService.getTextureById(newVal).img:null}),$scope.$watch("product.withCornice",$scope.calcPrice)}};$scope.getProduct=function(){$scope.totalColors=0,ProductService.getProduct({category:$routeParams.category&&$routeParams.category.split("=")[1]?"":$routeParams.category,subcategory:$routeParams.subcategory&&$routeParams.subcategory.split("=")[1]?"":$routeParams.subcategory,slug:$routeParams.product}).then(function(data){$scope.$parent.blockContent=data.blockContent?data.blockContent:"",$scope.product=data,ngMeta.setTag("description",data.description.text),ngMeta.setTitle(data.title+". Дизайн окна."),$scope.product.allowHeight=data.isHeightVisible,$scope.totalColors=data.colors,$scope.product.cornice.cartText=data.cornice.text,$scope.product.cornice.text=$sce.trustAsHtml(data.cornice.text),$scope.product.cornice.description=$sce.trustAsHtml(data.cornice.description),$scope.product.description.text=$sce.trustAsHtml(data.description.text),$scope.product.construction.text=$sce.trustAsHtml(data.construction.text),$scope.product.dimensions={},$scope.product.withCornice=!1,$scope.product.priceExactly=!1,$scope.gallery.currentImage=0,$scope.getTextures()},function(err){$log.log(err)})},$scope.addToCart=function(){$scope.product.texture=$scope.currentTexture.model,$scope.product.title=$scope.product.product_name,CartService.addProduct($scope.product)},$scope.buyOneClick=function(){$scope.product.texture=$scope.currentTexture.model,CartService.addOneClick($scope.product),DialogService.setState("oneclick")},$scope.getTextures=function(){TexturesService.getTextures({category:$routeParams.category,subcategory:$routeParams.subcategory,slug:$routeParams.product}).then(function(data){getTexturesPrices(data),$scope.getProducts()},function(err){$log.log(err)})},$scope.getProducts=function(){ProductService.getSeeAlsoList({productId:$scope.product.id}).then(function(data){$scope.catalogItems=data.slice(0,$scope.desktop?4:3)},function(err){$log.log(err)})},$scope.getYoutubeId=function(url){return youtubeEmbedUtils.getIdFromURL(url)},$scope.showConstruction=function(e){DialogService.setImage($scope.product.construction.scheme),DialogService.setState("picture")},$scope.getTextureById=function(id){$scope.currentTexture=TexturesService.getTextureById(id)},$scope.filterTextures=function(){if($scope.textures.length>0){var colors=$scope.textureColors2,price_min=$scope.texturePrice.min,price_max=$scope.texturePrice.max,textures=TexturesService.filterTextures(function(item){return item.price<=price_max&&item.price>=price_min&&(colors.length?_.include(colors,item.color):!0)});updateTextures(textures)}},$scope.resetSlider=function(){$scope.priceSlider={min:$scope.minPrice,max:$scope.maxPrice,options:{floor:$scope.minPrice,ceil:$scope.maxPrice}},$scope.texturePrice.min=$scope.priceSlider.min,$scope.texturePrice.max=$scope.priceSlider.max,$scope.filterTextures()},$scope.$on("rangeDirective.updateRangeSlider",function(e){$scope.texturePrice.min=$scope.priceSlider.min,$scope.texturePrice.max=$scope.priceSlider.max,$scope.filterTextures()}),$scope.$on("ResponsiveService.updateState",function(){$scope.$apply(function(){$scope.desktop=ResponsiveService.getState("desktop"),$scope.mobile=ResponsiveService.getState("mobileLandscape")})}),$scope.$watchCollection("textureColors",function(){$scope.textureColors2=_.reduce($scope.textureColors,function(result,n,key){return n===!0&&result.push(key),result},[]),$scope.filterTextures()}),$scope.moveGallery=function(direction){var position=$scope.gallery.currentImage+direction;position>=$scope.product.gallery.length?position=0:0>position&&(position=$scope.product.gallery.length-1),$scope.gallery.currentImage=position},$scope.clearTextureColor=function(){$scope.textureColors={},$scope.$parent.toggleColorsPopup=!1},$scope.clearMobileTextureColor=function(){$scope.textureColors={},$scope.toggleMobilePopup=!1},$scope.mobileFilterMenu=function(){$scope.toggleMobilePopup=!$scope.toggleMobilePopup,$scope.$parent.filterOpened=!$scope.$parent.filterOpened},$scope.init()}angular.module("productPageCtrl",["texturesService","productService","cartService","dialogService","configService","reviewsDirective"]).controller("ProductPageCtrl",["ngMeta","$scope","$log","youtubeEmbedUtils","$location","$routeParams","TexturesService","ProductService","CartService","DialogService","ConfigService","$sce","$timeout","ResponsiveService",productPageCtrl])}(),function(){"use strict";function questionCtrl($scope,$log,QuestionService){$scope.init=function(){$scope.getQuestion()},$scope.getQuestion=function(number){QuestionService.getQuestion({number:number}).then(function(data){$scope.question=data},function(err){$log.error(err)})},$scope.init()}angular.module("questionCtrl",["questionService"]).controller("QuestionCtrl",["$scope","$log","QuestionService",questionCtrl])}(),function(){"use strict";function responsiveCtrl($scope,$log,$window,ResponsiveService){$scope.$window=$window,$scope.checkWidth=function(width){ResponsiveService.updateWidth(width)}}angular.module("responsiveCtrl",["responsiveService"]).controller("ResponsiveCtrl",["$scope","$log","$window","ResponsiveService",responsiveCtrl])}(),function(){"use strict";function reviewsCtrl($scope,$log,ReviewsService){$scope.init=function(){$scope.reviews={},$scope.formData={},$scope.formData.rating=5,$scope.formData.product=$scope.productId,$scope.reviewFormVisible=!1,$scope.formSubmitted=!1,$scope.showLoadMoreBtn=!0,$scope.getReviews($scope.productId),$scope.allReviews=0},$scope.getReviews=function(product){ReviewsService.getReviews({product:product},5).then(function(data){$scope.reviews=data,$scope.reviews.avg_rounded=Math.round(data.avg_rating),$scope.allReviews=data.total,$scope.allReviews===$scope.reviews.list.length&&($scope.showLoadMoreBtn=!1)},function(err){$log.error(err)})},$scope.toggleReviewForm=function(){$scope.reviewFormVisible=!$scope.reviewFormVisible},$scope.loadMoreReviews=function(){Array.prototype.push.apply($scope.reviews.list,ReviewsService.loadReviews($scope.reviews.list.length,5)),$scope.allReviews===$scope.reviews.list.length&&($scope.showLoadMoreBtn=!1)},$scope.submitReview=function(){ReviewsService.submitReview($scope.formData).then(function(data){$scope.formSubmitted=!0},function(err){$log.log(err)})},$scope.init()}angular.module("reviewsCtrl",["reviewsService"]).controller("ReviewsCtrl",["$scope","$log","ReviewsService",reviewsCtrl])}(),function(){"use strict";function searchCtrl($rootScope,$scope,$log,SearchService,DialogService){$scope.init=function(){$scope.term="",$scope.loading=!1,$scope.nothing=!1,$scope.$watch("term",function(){$scope.term.length>3?$scope.search():$scope.results=[]})},$scope.search=function(e){return e&&e.preventDefault(),$scope.loading=!0,SearchService.find($scope.term).then(function(data){$scope.results=data,$scope.nothing=!(data.length>0),$scope.loading=!1,$log.log(data)},function(err){$log.log(err),$scope.nothing=!0,$scope.loading=!1}),!1},$scope.clickResult=function(){DialogService.setState(!1);

},$scope.init()}angular.module("searchCtrl",["searchService","dialogService"]).controller("SearchCtrl",["$rootScope","$scope","$log","SearchService","DialogService",searchCtrl])}(),function(){"use strict";function articleCtrl($scope,$log,$sce,$routeParams,ArticleService,SocialShareService){var networks=["vk","ok","fb"];$scope.init=function(){$scope.$parent.constructorHeader=!1,$scope.article={},$scope.socials=[],$scope.getArticle()},$scope.getArticle=function(){var slug=$routeParams.slug||$scope.slug;ArticleService.getTrend(slug).then(function(data){$scope.article=data,$scope.article.content=$sce.trustAsHtml(data.text),$scope.prepareShareUrls()},function(err){$log.log(err)})},$scope.prepareShareUrls=function(){angular.forEach(networks,function(value,key){$scope.socials.push({name:value,icon:"icons/icons.svg#"+value,url:SocialShareService.getShareUrl(value,{title:$scope.article.title,url:$scope.article.url,description:$sce.trustAsHtml($scope.article.description),image:$scope.article.main_img})})})},$scope.init()}angular.module("trendCtrl",["articleService","socialShareService"]).controller("trendCtrl",["$scope","$log","$sce","$routeParams","ArticleService","SocialShareService",articleCtrl])}(),function(){"use strict";function articlePreviewDirective(){return{restrict:"E",templateUrl:"views/directives/article-preview.html",controller:"trendCtrl",scope:{slug:"@"},replace:!0,link:articlePreviewDirectiveLink}}function articlePreviewDirectiveLink(scope,el,attr){scope.slug=attr.slug}angular.module("articlePreviewDirective",["trendCtrl"]).directive("articlePreview",[articlePreviewDirective]).filter("unsafe",function($sce){return $sce.trustAsHtml})}(),function(){"use strict";function benefitsDirective(){return{restrict:"E",templateUrl:"views/directives/benefits.html",controller:"BenefitsCtrl",scope:{idproduct:"@",title:"@",url:"@"},replace:!0,link:benefitsDirectiveLink}}function benefitsDirectiveLink(scope,el,attr){attr.url=attr.url||"#"}angular.module("benefitsDirective",["benefitsCtrl"]).directive("benefits",[benefitsDirective])}(),function(){"use strict";angular.module("cartDirective",["cartCtrl"]).directive("cart",["$window","$document",function($window,$document){return{restrict:"E",templateUrl:"views/directives/cart.html",controller:"CartCtrl",scope:{},replace:!0,link:function(scope,el,attr){var $dropdown=el.find(".cart__dropdown");$dropdown.appendTo(angular.element("header.site-header")),$(".js-customScroll").mCustomScrollbar({axis:"y",scrollbarPosition:"inside",theme:"dark-3"}),angular.element($document[0].body).on("touchend",function(e){!scope.dropdownVisible||$(e.target).closest(".cart__dropdown")[0]||$(e.target).closest(".cart")[0]||scope.$apply(function(){scope.dropdownVisible=!1})})}}}])}(),function(){"use strict";function catalogResponsiveDirective(){return{restrict:"A",replace:!0,link:catalogResponsiveLink}}function catalogResponsiveLink(scope,el,attr){function catalogResponsiveAction(){scope.responsive.getState("tabletPortrait")?(angular.element(".mobile-aside__content.filters").html(""),el.appendTo(angular.element(".mobile-aside__content.filters"))):el.prependTo($parent)}var $parent=el.parent();scope.$on("ResponsiveService.updateState",catalogResponsiveAction),catalogResponsiveAction()}angular.module("catalogResponsiveDirective",["catalogCtrl"]).directive("catalogResponsive",[catalogResponsiveDirective])}(),function(){"use strict";function checkboxDirective(){return{restrict:"E",templateUrl:"views/directives/checkbox.html",scope:{model:"=",checked:"@",disabled:"@",name:"@",label:"@",value:"@"},replace:!0,link:checkboxDirectiveLink}}function checkboxDirectiveLink(scope,el,attr){}angular.module("checkboxDirective",[]).directive("checkbox",[checkboxDirective])}(),function(){"use strict";function colorDirective(){return{restrict:"E",templateUrl:"views/directives/color.html",scope:{model:"=",checked:"@",disabled:"@",fill:"@",name:"@",value:"@"},replace:!0,link:colorDirectiveLink}}function colorDirectiveLink(scope,el,attr){}angular.module("colorDirective",[]).directive("color",[colorDirective])}(),function(){"use strict";function constructorPreviewDirective(){return{restrict:"E",scope:{background:"@",blind:"@"},replace:!0,templateUrl:"views/directives/constructor-preview.html",controller:"ConstructorPreviewCtrl",link:constructorPreviewDirectiveLink}}function constructorPreviewDirectiveLink(scope,el,attr){{var applyTransform,getTransform,makeTransformable,controlPoints;scope.$log}getTransform=function(from,to){var A,H,b,h,i,k,k_i,l,lhs,m,ref,rhs;for(console.assert(from.length===(ref=to.length)&&4===ref),A=[],i=k=0;4>k;i=++k)A.push([from[i].x,from[i].y,1,0,0,0,-from[i].x*to[i].x,-from[i].y*to[i].x]),A.push([0,0,0,from[i].x,from[i].y,1,-from[i].x*to[i].y,-from[i].y*to[i].y]);for(b=[],i=l=0;4>l;i=++l)b.push(to[i].x),b.push(to[i].y);for(h=numeric.solve(A,b),H=[[h[0],h[1],0,h[2]],[h[3],h[4],0,h[5]],[0,0,1,0],[h[6],h[7],0,1]],i=m=0;4>m;i=++m)lhs=numeric.dot(H,[from[i].x,from[i].y,0,1]),k_i=lhs[3],rhs=numeric.dot(k_i,[to[i].x,to[i].y,0,1]),console.assert(numeric.norm2(numeric.sub(lhs,rhs))<1e-9,"Not equal:",lhs,rhs);return H},applyTransform=function(element,originalPos,targetPos,callback){var H,from,i,j,p,to;return from=function(){var k,len,results;for(results=[],k=0,len=originalPos.length;len>k;k++)p=originalPos[k],results.push({x:p[0]-originalPos[0][0],y:p[1]-originalPos[0][1]});return results}(),to=function(){var k,len,results;for(results=[],k=0,len=targetPos.length;len>k;k++)p=targetPos[k],results.push({x:p[0]-originalPos[0][0],y:p[1]-originalPos[0][1]});return results}(),H=getTransform(from,to),$(element).css({transform:"matrix3d("+function(){var k,results;for(results=[],i=k=0;4>k;i=++k)results.push(function(){var l,results1;for(results1=[],j=l=0;4>l;j=++l)results1.push(H[j][i].toFixed(20));return results1}());return results}().join(",")+")","transform-origin":"0 0"}),"function"==typeof callback?callback(element,H):void 0},(makeTransformable=function(selector,callback){return $(selector).each(function(i,element){var originalPos,p,position;return controlPoints=controlPoints||[],$(element).css("transform",""),controlPoints=function(){var k,len,ref,results;for(ref=["left top","left bottom","right top","right bottom"],results=[],k=0,len=ref.length;len>k;k++)position=ref[k],results.push($("<div>").css({position:"absolute"}).appendTo(el).position({at:position,of:element,collision:"none"}));return results}(),$(controlPoints).each(function(index,el){el.addClass("constructor-preview__dot")}),originalPos=function(){var k,len,results;for(results=[],k=0,len=controlPoints.length;len>k;k++)p=controlPoints[k],results.push([p.offset().left,p.offset().top]);return results}(),$(controlPoints).draggable({start:function(_this){return function(){return $(element).css({left:10,top:60}),$(element).css("pointer-events","none")}}(this),drag:function(_this){return function(){return applyTransform(element,originalPos,function(){var k,len,results;for(results=[],k=0,len=controlPoints.length;len>k;k++)p=controlPoints[k],results.push([p.offset().left,p.offset().top]);return results}(),callback)}}(this),stop:function(_this){return function(){return applyTransform(element,originalPos,function(){var k,len,results;for(results=[],k=0,len=controlPoints.length;len>k;k++)p=controlPoints[k],results.push([p.offset().left,p.offset().top]);return results}(),callback),$(element).css("pointer-events","auto")}}(this)}),element})})(".js-box",function(element,H){});var offset={left:0,top:0},begin={left:0,top:0},end={left:0,top:0};el.find(".js-box").draggable(function(){return{start:function(){begin=el.find(".js-box").position(),controlPoints.length>0&&$(controlPoints).each(function(index,el){el.hide()})},stop:function(){end=el.find(".js-box").position(),offset={left:end.left-begin.left,top:end.top-begin.top},controlPoints.length>0&&$(controlPoints).each(function(index,el){el.show().css({left:el.position().left+offset.left,top:el.position().top+offset.top})})}}}())}angular.module("constructorPreviewDirective",["constructorPreviewCtrl"]).directive("constructorPreview",[constructorPreviewDirective])}(),function(){"use strict";function dialogDirective(){return{restrict:"E",templateUrl:"views/directives/dialog.html",controller:"DialogCtrl",scope:{title:"@",url:"@"},replace:!0,link:dialogDirectiveLink}}function dialogDirectiveLink(scope,el,attr){scope.$watch("state",function(){0==scope.state?$("body").removeClass("modal-open"):$("body").addClass("modal-open")})}angular.module("dialogDirective",["dialogCtrl"]).directive("dialog",[dialogDirective])}(),function(){"use strict";function menuHiderDirective(){return{restrict:"A",scope:{},replace:!0,controller:"HiderCtrl",link:hiderDirectiveLink}}function hiderDirectiveLink(scope,el,attr){var $window=scope.$window,hidePoint=attr.hiderPoint||0,className=attr.hiderClass||"hidden";angular.element($window).bind("scroll",function(){el.toggleClass(className,$window.scrollY>hidePoint)})}angular.module("hiderDirective",["hiderCtrl"]).directive("hider",[menuHiderDirective])}(),function(){"use strict";function newsDirective(){return{restrict:"E",templateUrl:"views/directives/news.html",controller:"NewsCtrl",scope:{title:"@",url:"@"},replace:!0,link:newsDirectiveLink}}function newsDirectiveLink(scope,el,attr){setInterval(function(){angular.element(".news__item").eq(scope.currentNews).removeClass("active"),scope.currentNews=scope.news.length==scope.currentNews+1?0:scope.currentNews+1,angular.element(".news__item").eq(scope.currentNews).addClass("active")},1e4)}angular.module("newsDirective",["newsCtrl"]).directive("news",[newsDirective])}(),function(){"use strict";function offCanvasDirective(){return{restrict:"A",scope:!1,replace:!0,link:offCanvasDirectiveLink}}function offCanvasDirectiveLink(scope,el,attr){scope.$watch("offCanvasSide",function(newVal){newVal?el.addClass("move-"+scope.offCanvasSide):el.removeClass("move-left move-right")})}angular.module("offCanvasDirective",[]).directive("offCanvas",[offCanvasDirective])}(),function(){"use strict";function parallaxDirective(){return{restrict:"A",scope:{},replace:!0,controller:"ParallaxCtrl",link:parallaxDirectiveLink}}function parallaxDirectiveLink(scope,el,attr){var $window=scope.$window,start=attr.parallaxStart||0,end=attr.parallaxEnd||500;angular.element($window).bind("scroll",function(){$window.scrollY<=end&&$window.scrollY>start&&el.css("transform","translateY("+$window.scrollY/5+"px)")})}angular.module("parallaxDirective",["parallaxCtrl"]).directive("parallax",[parallaxDirective])}(),function(){"use strict";function questionDirective(){return{restrict:"E",templateUrl:"views/directives/question.html",controller:"QuestionCtrl",scope:{number:"@",title:"@",description:"@",link:"@"},replace:!0,link:questionDirectiveLink}}function questionDirectiveLink(scope,el,attr){attr.link=attr.link||"#"}angular.module("questionDirective",["questionCtrl"]).directive("question",[questionDirective])}(),function(){"use strict";function rangeDirective(){return{restrict:"E",templateUrl:"views/directives/range.html",scope:{min:"=",max:"=",options:"@"},replace:!0,link:{pre:rangeDirectiveLink}}}function rangeDirectiveLink(scope,el,attr){scope.options=angular.fromJson(attr.options),scope.options.onEnd=function(){scope.$emit("rangeDirective.updateRangeSlider")};var min=scope.options.floor,max=scope.options.ceil;scope.$watch("min",function(value){value>max&&(scope.min=scope.max),min>value&&(scope.min=min),scope.min>scope.max&&(scope.min=scope.max)}),scope.$watch("max",function(value){value>max&&(scope.max=max),min>value&&(scope.max=scope.min),scope.max<scope.min&&(scope.max=scope.min)})}angular.module("rangeDirective",["rzModule"]).directive("range",[rangeDirective])}(),function(){"use strict";function responsiveDirective(){return{restrict:"E",scope:{},replace:!0,controller:"ResponsiveCtrl",link:responsiveDirectiveLink}}function responsiveDirectiveLink(scope,el,attr){var w=scope.$window,timer=0;w.onresize=function(){clearTimeout(timer),timer=setTimeout(function(){scope.checkWidth($(w).width())},300)},scope.checkWidth($(w).width())}angular.module("responsiveDirective",["responsiveCtrl"]).directive("responsive",[responsiveDirective])}(),function(){"use strict";function reviewsDirective(){return{restrict:"E",templateUrl:"views/directives/reviews.html",controller:"ReviewsCtrl",scope:{productId:"@"},replace:!0,link:reviewsLink}}function reviewsLink(scope,el,attr){scope.productId=attr.productId}angular.module("reviewsDirective",["reviewsCtrl"]).directive("reviews",[reviewsDirective])}(),function(){"use strict";function seoDirective(){return{restrict:"E",templateUrl:"views/directives/seo.html",controller:"MainCtrl",scope:{html:"@"},replace:!0,link:seoLink}}function seoLink(scope,el,attr){}angular.module("seoDirective",["mainCtrl"]).directive("seo",[seoDirective]).filter("unsafe",function($sce){return $sce.trustAsHtml})}(),function(){"use strict";function colorDirective(){return{restrict:"E",templateUrl:"views/directives/texture.html",scope:{model:"=",checked:"@",disabled:"@",fill:"@",name:"@",value:"@"},replace:!0,link:textureDirectiveLink}}function textureDirectiveLink(scope,el,attr){}angular.module("textureDirective",[]).directive("texture",[colorDirective])}(),function(){"use strict";function articleService(API_PATH,$http,$q,ConfigService){function getArticle(slug){var url=API_PATH+ConfigService.articlePath,defer=$q.defer();return $http.get(url,{params:{slug:slug}}).success(function(data){defer.resolve(data)}).error(function(res,errCode){defer.reject({code:errCode,text:"api access [%s] error!".replace("%s",url)})}),defer.promise}function getTrend(slug){var url=API_PATH+ConfigService.homeArticlePath,defer=$q.defer();return $http.get(url,{params:{slug:slug}}).success(function(data){defer.resolve(data)}).error(function(res,errCode){defer.reject({code:errCode,text:"api access [%s] error!".replace("%s",url)})}),defer.promise}var service={getArticle:getArticle,getTrend:getTrend};return service}angular.module("articleService",["configService"]).factory("ArticleService",["API_PATH","$http","$q","ConfigService",articleService])}(),function(){"use strict";function benefitsService(API_PATH,$http,$q){function getBenefits(apiUrl,params){var url=API_PATH+apiUrl,defer=$q.defer();return $http.get(url,{params:params}).success(function(data){defer.resolve(data)}).error(function(res,errCode){defer.reject({code:errCode,text:"api access [%s] error!".replace("%s",url)})}),defer.promise}var service={getBenefits:getBenefits};return service}angular.module("benefitsService",[]).factory("BenefitsService",["API_PATH","$http","$q",benefitsService])}(),function(){"use strict";function cartService($rootScope,API_PATH,$http,$q,$interpolate,localStorageService,ConfigService){function addProduct(product){var clone=_.cloneDeep(product);products.push(clone),localStorageService.set("cart_products",JSON.stringify(products))}function removeProduct(idx){products.splice(idx,1),localStorageService.set("cart_products",JSON.stringify(products))}function getProducts(){return products}function addOneClick(product){oneClickProduct=_.cloneDeep(product)}function getOneClick(){return oneClickProduct}function formatProduct(product){return product.allowHeight&&product.dimensions?$interpolate("{{product.title}}"+(product.texture?" модель {{product.texture}}":" ")+(product.dimensions.width&&product.dimensions.height?" ({{product.dimensions.width}} cм x {{product.dimensions.height}} cм)":"")+(product.withCornice?" + {{product.cornice.cartText}}":""))({product:product}):!product.allowHeight&&product.dimensions?$interpolate("{{product.title}}"+(product.texture?" модель {{product.texture}}":" ")+(product.dimensions.width?" ({{product.dimensions.width}} см)":"")+(product.withCornice?" + {{product.cornice.cartText}}":""))({product:product}):$interpolate("{{product.title}}"+(product.texture?" модель {{product.texture}}":" ")+(product.withCornice?" + {{product.cornice.cartText}}":""))({product:product})}function submitOrder(params){var url=API_PATH+ConfigService.orderPath,defer=$q.defer(),data={};return"oneclick"===params.context?data.text=formatProduct(oneClickProduct):"order"===params.context&&(data.text=_.reduce(products,function(result,product,key){return result+=key+1+". "+formatProduct(product)+"\n"},"")),data.time=params.hour.label+" "+params.min.label,angular.extend(data,params),delete data.context,delete data.hour,delete data.min,$http.post(url,data).success(function(response){defer.resolve(response)},function(err){$log.log(err)}),defer.promise}function submitCallMe(params){var url=API_PATH+ConfigService.callMe,defer=$q.defer(),data={};return data.text="Перезвоните мне",data.time=params.hour.label+" "+params.min.label,angular.extend(data,params),delete data.context,delete data.hour,delete data.min,$http.post(url,data).success(function(response){defer.resolve(response)},function(err){$log.log(err)}),defer.promise}function submitFeedback(params){var url=API_PATH+ConfigService.feedbackPath,defer=$q.defer();return $http.post(url,params).success(function(response){defer.resolve(response)},function(err){$log.log(err)}),defer.promise}var products=JSON.parse(localStorageService.get("cart_products"))||[],oneClickProduct={},service={addProduct:addProduct,removeProduct:removeProduct,getProducts:getProducts,getOneClick:getOneClick,addOneClick:addOneClick,submitOrder:submitOrder,submitCallMe:submitCallMe,submitFeedback:submitFeedback};return service}angular.module("cartService",["configService"]).factory("CartService",["$rootScope","API_PATH","$http","$q","$interpolate","localStorageService","ConfigService",cartService])}(),function(){"use strict";function catalogService(API_PATH,$http,$q,ConfigService){function getCatalog(params){var url=API_PATH+ConfigService.catalogPath,defer=$q.defer();return $http.get(url,{params:params}).success(function(data){defer.resolve(data)}).error(function(res,errCode){defer.reject({code:errCode,text:"api access [%s] error!".replace("%s",url)})}),defer.promise}var service={getCatalog:getCatalog};return service}angular.module("catalogService",["configService"]).factory("CatalogService",["API_PATH","$http","$q","ConfigService",catalogService])}(),function(){"use strict";function configService(){var config=angular.extend({},{featuredProductPath:"featuredProduct.json",productListPath:"productList.json",productHomeListPath:"productList.json",productSeeAlsoListPath:"similarGoods.json",productPagePath:"product.json",questionPath:"questions.json",articlePath:"article.json",catalogPath:"catalog.json",constructorTexturesPath:"textures.json",texturesPath:"textures.json",reviewsPath:"reviews.json",newReviewPath:"review-post-response.json",newsPath:"news.json",searchPath:"search.json",minPrice:0,maxPrice:99999,serverTime:"serverTime.json",openHour:9,closeHour:21,callMe:"call-me.json",orderPath:"order.json",feedbackPath:"feedback.json",structurePath:"structure.json",homeArticleSlug:"trends",homeArticlePath:"mainPageAds.json"},window.appLicationConfig);return config}angular.module("configService",[]).factory("ConfigService",[configService])}(),function(){"use strict";function dialogService($rootScope){var opened=!1,image="",setState=function(newState){opened=newState,$rootScope.$broadcast("DialogService.updateState")},getState=function(){return opened},setImage=function(picture){image=picture},getImage=function(){return image},service={getState:getState,setState:setState,getImage:getImage,setImage:setImage};return service}angular.module("dialogService",[]).factory("DialogService",["$rootScope",dialogService])}(),function(){"use strict";function menuService(API_PATH,$http,$q,ConfigService){function getMenu(){var url=API_PATH+ConfigService.structurePath,defer=$q.defer();return _.isEmpty(menu)?$http.get(url).success(function(data){defer.resolve(data)}).error(function(res,errCode){defer.reject({code:errCode,text:"api access [%s] error!".replace("%s",url)})}):defer.resolve(menu),defer.promise}var menu={},service={getMenu:getMenu};return service}angular.module("menuService",["configService"]).factory("MenuService",["API_PATH","$http","$q","ConfigService",menuService])}(),function(){"use strict";function newsService(API_PATH,$http,$q,$sce,ConfigService){function getNews(){var url=API_PATH+ConfigService.newsPath,defer=$q.defer();return $http.get(url).success(function(data){angular.forEach(data,function(item){item.trustedTitle=$sce.trustAsHtml(item.title)}),defer.resolve(data)}).error(function(res,errCode){defer.reject({code:errCode,text:"api access [%s] error!".replace("%s",url)})}),defer.promise}var service={getNews:getNews};return service}angular.module("newsService",["configService"]).factory("NewsService",["API_PATH","$http","$q","$sce","ConfigService",newsService])}(),function(){"use strict";function productService(API_PATH,$http,$q,ConfigService){var FetchPrototype=function(path,callback){return function(params){var url=API_PATH+path,defer=$q.defer();return $http.get(url,{params:params}).success(function(data){callback(defer,data)}).error(function(res,errCode){defer.reject({code:errCode,text:"api access [%s] error!".replace("%s",url)})}),defer.promise}},getProduct=FetchPrototype(ConfigService.productPagePath,function(defer,data){defer.resolve(data)}),getList=FetchPrototype(ConfigService.productListPath,function(defer,data){service.products=data,defer.resolve(data)}),getHomeList=FetchPrototype(ConfigService.productHomeListPath,function(defer,data){service.products=data,defer.resolve(data)}),getSeeAlsoList=FetchPrototype(ConfigService.productSeeAlsoListPath,function(defer,data){service.products=data,defer.resolve(data)}),getFeatured=FetchPrototype(ConfigService.featuredProductPath,function(defer,data){service.featuredProduct=data,defer.resolve(data)}),service={getProduct:getProduct,getList:getList,getHomeList:getHomeList,getSeeAlsoList:getSeeAlsoList,getFeatured:getFeatured};return service}angular.module("productService",["configService"]).factory("ProductService",["API_PATH","$http","$q","ConfigService",productService])}(),function(){"use strict";function questionService(API_PATH,$http,$q,ConfigService){function getQuestion(params){var url=API_PATH+ConfigService.questionPath,defer=$q.defer();return $http.get(url,{params:params}).success(function(data){defer.resolve(data)}).error(function(res,errCode){defer.reject({code:errCode,text:"api access [%s] error!".replace("%s",url)})}),defer.promise}var service={getQuestion:getQuestion};return service}angular.module("questionService",["configService"]).factory("QuestionService",["API_PATH","$http","$q","ConfigService",questionService])}(),function(){"use strict";function responsiveService($rootScope){var scrollWidth=30,responsiveStatus={desktop:!1,talbet:!1,tabletPortrait:!1,mobile:!1},rules={desktop:function(width){return width>=1280+scrollWidth},tablet:function(width){return 1280+scrollWidth>width&&width>960+scrollWidth},tabletPortrait:function(width){return 960+scrollWidth>=width},mobileLandscape:function(width){return 640+scrollWidth>=width},mobile:function(width){return 320+scrollWidth>=width}},setState=function(){$rootScope.$broadcast("ResponsiveService.updateState")},getState=function(key){return responsiveStatus[key]},updateWidth=function(width){var update=!1;_.each(rules,function(fn,key){fn(width)!==responsiveStatus[key]&&(responsiveStatus[key]=fn(width),update=!0)}),update&&setState()},service={updateWidth:updateWidth,getState:getState};return service}angular.module("responsiveService",[]).factory("ResponsiveService",["$rootScope",responsiveService])}(),function(){"use strict";function reviewsService(API_PATH,$http,$q,ConfigService){function getReviews(params,limit){var url=API_PATH+ConfigService.reviewsPath,defer=$q.defer();return service.product===params.product?defer.resolve(angular.extend({},service.data,{list:service.list.slice(0,limit)})):$http.get(url,{params:params}).success(function(data){service.list=data.list,service.data=data,service.data.total=data.list.length,service.data.list=null,defer.resolve(angular.extend({},service.data,{list:service.list.slice(0,limit)}))}).error(function(res,errCode){defer.reject({code:errCode,text:"api access [%s] error!".replace("%s",url)})}),service.product=params.product,defer.promise}function loadReviews(skip,limit){return service.list.slice(skip,limit+skip)}function submitReview(params){var url=API_PATH+ConfigService.newReviewPath,defer=$q.defer();return $http.post(url,params).success(function(data){defer.resolve(data)},function(err){$log.log(err)}),defer.promise}var service={getReviews:getReviews,loadReviews:loadReviews,submitReview:submitReview};return service}angular.module("reviewsService",["configService"]).factory("ReviewsService",["API_PATH","$http","$q","ConfigService",reviewsService])}(),function(){"use strict";function searchService(API_PATH,$http,$q,ConfigService){function find(term){var url=API_PATH+ConfigService.searchPath,defer=$q.defer();return $http.get(url,{params:{term:term}}).success(function(data){defer.resolve(data)}).error(function(res,errCode){defer.reject({code:errCode,text:"api access [%s] error!".replace("%s",url)})}),defer.promise}var service={find:find};return service}angular.module("searchService",["configService"]).factory("SearchService",["API_PATH","$http","$q","ConfigService",searchService])}(),function(){"use strict";function socialShareService(){function getShareUrl(network,params){var url="";switch(network){case"vk":url="https://vk.com/share.php?url="+encodeURIComponent(window.location.href)+"&title="+encodeURIComponent(params.title)+"&description="+encodeURIComponent(params.description)+"&image="+encodeURIComponent(params.image)+"&noparse=true";break;case"ok":url="http://www.ok.ru/dk?st.cmd=addShare&st.s=1&st.comments="+encodeURIComponent(params.description)+"&st._surl="+encodeURIComponent(window.location.href);break;case"fb":url="http://www.facebook.com/sharer.php?s=100&p[title]="+encodeURIComponent(params.title)+"&p[summary]="+encodeURIComponent(params.description)+"&p[url]="+encodeURIComponent(window.location.href)+"&p[images][0]="+encodeURIComponent(params.image)}return url}var service={getShareUrl:getShareUrl};return service}angular.module("socialShareService",[]).factory("SocialShareService",[socialShareService])}(),function(){"use strict";function texturesService(API_PATH,$http,$q,ConfigService){function getConstructorTextures(params){var url=API_PATH+ConfigService.constructorTexturesPath,defer=$q.defer();return $http.get(url,{params:params}).success(function(data){service.textures=data,defer.resolve(data)}).error(function(res,errCode){defer.reject({code:errCode,text:"api access [%s] error!".replace("%s",url)})}),defer.promise}function getTextures(params){var url=API_PATH+ConfigService.texturesPath,defer=$q.defer();return $http.get(url,{params:params}).success(function(data){service.textures=data,defer.resolve(data)}).error(function(res,errCode){defer.reject({code:errCode,text:"api access [%s] error!".replace("%s",url)})}),defer.promise}function filterTextures(fn){return _.filter(service.textures,fn)}function getTextureById(id){return _.findWhere(service.textures,{id:id})}function getTextureBySlug(slug){return _.findWhere(service.textures,{slug:slug})}var service={getTextures:getTextures,getConstructorTextures:getConstructorTextures,getTextureById:getTextureById,getTextureBySlug:getTextureBySlug,filterTextures:filterTextures};return service}angular.module("texturesService",["configService"]).factory("TexturesService",["API_PATH","$http","$q","ConfigService",texturesService])}(),function(){"use strict";function timeService($rootScope,ConfigService,API_PATH,$http,$q){function getServerTime(){var url=API_PATH+ConfigService.serverTime,defer=$q.defer();return $http.get(url).success(function(data){defer.resolve(data)}).error(function(res,errCode){defer.reject({code:errCode,text:"api access [%s] error!".replace("%s",url)})}),defer.promise}var time,storeTime=new Date;getServerTime().then(function(data){storeTime=new Date(data)});var logCurrentTime=function(){time=new Date},getStoreTime=function(){var current=new Date,diff=current-time;return new Date(storeTime.getTime()+diff)},isWorkingTime=function(){var time=getStoreTime();return time.getHours()<ConfigService.closeHour&&time.getHours()>=ConfigService.openHour?!0:!1},getWorkingHours=function(){return ConfigService.openHour+"-"+ConfigService.closeHour+"ч"},service={logCurrentTime:logCurrentTime,getStoreTime:getStoreTime,isWorkingTime:isWorkingTime,getWorkingHours:getWorkingHours};return service}angular.module("timeService",["configService"]).factory("TimeService",["$rootScope","ConfigService","API_PATH","$http","$q",timeService])}();
//# sourceMappingURL=../js/app.js.map